# ë‚˜ë¹„ì–Œ ì±—ë´‡ ë°ì´í„°ë² ì´ìŠ¤ ì¢…í•© ê°€ì´ë“œ v2 (ì™„ì „íŒ)

## ëª©ì°¨
1. [ê°œìš”](#1-ê°œìš”)
2. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#2-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
3. [ëŒ€í™” ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸](#3-ëŒ€í™”-ì²˜ë¦¬-íŒŒì´í”„ë¼ì¸)
4. [í•µì‹¬ ë°ì´í„° í…Œì´ë¸”](#4-í•µì‹¬-ë°ì´í„°-í…Œì´ë¸”)
5. [AI ìš´ì˜ í…Œì´ë¸”](#5-ai-ìš´ì˜-í…Œì´ë¸”)
6. [ì„±ëŠ¥ ìµœì í™” í…Œì´ë¸”](#6-ì„±ëŠ¥-ìµœì í™”-í…Œì´ë¸”)
7. [ML íŠ¹ì§• ë° í•™ìŠµ í…Œì´ë¸”](#7-ml-íŠ¹ì§•-ë°-í•™ìŠµ-í…Œì´ë¸”)
8. [ë¶„ì„ ë° ëª¨ë‹ˆí„°ë§ í…Œì´ë¸”](#8-ë¶„ì„-ë°-ëª¨ë‹ˆí„°ë§-í…Œì´ë¸”)
9. [Intentì™€ Entities ë¶„ë¦¬ ì„¤ê³„](#9-intentì™€-entities-ë¶„ë¦¬-ì„¤ê³„)
10. [ë°ì´í„° ì €ì¥ ì „ëµ](#10-ë°ì´í„°-ì €ì¥-ì „ëµ)
11. [íŒŒìƒ í•„ë“œ ë° íŠ¹ì§• ì—”ì§€ë‹ˆì–´ë§](#11-íŒŒìƒ-í•„ë“œ-ë°-íŠ¹ì§•-ì—”ì§€ë‹ˆì–´ë§)
12. [ì‹¤ì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤](#12-ì‹¤ì œ-ì‚¬ìš©-ì‹œë‚˜ë¦¬ì˜¤)
13. [êµ¬í˜„ ê°€ì´ë“œ](#13-êµ¬í˜„-ê°€ì´ë“œ)

---

## 1. ê°œìš”

ë‚˜ë¹„ì–Œ ì±—ë´‡ì€ **ê¸‰ì‹ì¹´ë“œ ì‚¬ìš©ìë¥¼ ìœ„í•œ AI ê¸°ë°˜ ë§›ì§‘ ì¶”ì²œ ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤. LLM + RAG + ì¶”ì²œ ì‹œìŠ¤í…œì„ ê²°í•©í•œ í•˜ì´ë¸Œë¦¬ë“œ ì•„í‚¤í…ì²˜ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### ë°ì´í„° ì†ŒìŠ¤ êµ¬ë¶„
- ğŸª **[SAMPLE_DATA]**: sample_data.xlsxì—ì„œ ì œê³µë˜ëŠ” ê¸°ë³¸ ë°ì´í„°
- ğŸ¤– **[CHATBOT_GENERATED]**: ì±—ë´‡ì´ ëŒ€í™”ë¥¼ í†µí•´ ìƒì„±í•˜ëŠ” ë°ì´í„°
- ğŸ”„ **[DERIVED]**: ê¸°ì¡´ ë°ì´í„°ë¥¼ ê°€ê³µí•˜ì—¬ íŒŒìƒëœ ë°ì´í„°
- ğŸš€ **[AI_COMPUTED]**: AI ëª¨ë¸ì´ ê³„ì‚°í•œ íŠ¹ì§• ë° ì ìˆ˜

### Feature í™œìš©ì²˜ ë²”ë¡€
- ğŸ’¬ **ì±—ë´‡ NLU/NLG**: ìì—°ì–´ ì´í•´ ë° ì‘ë‹µ ìƒì„±
- ğŸ” **RAG ê²€ìƒ‰**: ë²¡í„° ê²€ìƒ‰ ë° ì˜ë¯¸ì  ë§¤ì¹­
- ğŸ¯ **Wide&Deep**: ì¶”ì²œ ëª¨ë¸ì˜ Wide/Deep ì»´í¬ë„ŒíŠ¸
- â­ **ë‚˜ë¹„ì–Œ íŠ¹í™”**: ê¸‰ì‹ì¹´ë“œ ê´€ë ¨ íŠ¹í™” ê¸°ëŠ¥
- ğŸ“Š **ë¶„ì„/ëª¨ë‹ˆí„°ë§**: ì„±ëŠ¥ ì¶”ì  ë° ê°œì„ 

---

## 2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ ë°ì´í„° íë¦„
```
ì‚¬ìš©ì ì…ë ¥ â†’ ì „ì²˜ë¦¬ â†’ NLU(ì˜ë„+ì—”í‹°í‹°) â†’ RAG ê²€ìƒ‰ â†’ ì¶”ì²œ ëª¨ë¸ â†’ ì‘ë‹µ ìƒì„± â†’ í•™ìŠµ ë°ì´í„° ìˆ˜ì§‘ â†’ DB ì €ì¥
                            â†“                    â†“           â†“
                      NLU ìºì‹œ/í•™ìŠµ        ë²¡í„° ìºì‹œ    íŠ¹ì§• ì €ì¥
```

### ì£¼ìš” ì»´í¬ë„ŒíŠ¸
1. **NLU (ìì—°ì–´ ì´í•´)**: Intent ë¶„ë¥˜ + Entity ì¶”ì¶œ + ì‹ ë¢°ë„ í‰ê°€
2. **RAG (ê²€ìƒ‰ ì¦ê°• ìƒì„±)**: ì˜ë¯¸ì  ìœ ì‚¬ë„ ê¸°ë°˜ ê°€ê²Œ/ë©”ë‰´ ê²€ìƒ‰ + ìºì‹±
3. **Wide&Deep ì¶”ì²œ**: ê°œì¸í™”ëœ ì¶”ì²œ ìˆœìœ„ ê²°ì • + íŠ¹ì§• ì—”ì§€ë‹ˆì–´ë§
4. **ì¿ í° ì‹œìŠ¤í…œ**: ê¸‰ì‹ì¹´ë“œ ì”ì•¡ ë¶€ì¡± ì‹œ í• ì¸ ë§¤ì¹­ + ì§€ê°‘ ê´€ë¦¬
5. **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: ì‹¤ì‹œê°„ ì„±ëŠ¥ ì¶”ì  + ë³‘ëª© ì§€ì  íŒŒì•…
6. **í•™ìŠµ ì‹œìŠ¤í…œ**: LoRA íŒŒì¸íŠœë‹ + ì§€ì†ì  ê°œì„ 

---

## 3. ëŒ€í™” ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸

### Phase 1: ì…ë ¥ ì²˜ë¦¬ ë° ì „ì²˜ë¦¬
```python
# 1. UserInput ê°ì²´ ìƒì„±
user_input = UserInput(
    text="ë°°ê³ í”ˆë° 5ì²œì›ë°–ì— ì—†ì–´",
    user_id="user_123",
    timestamp=datetime.now(),
    session_id="session_abc"
)

# 2. í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬
preprocessed = self.preprocessor.preprocess(user_input.text)
# ê²°ê³¼: {
#     "normalized_text": "ë°°ê³ í”ˆë° 5ì²œì›ë°–ì— ì—†ì–´",
#     "keywords": ["ë°°ê³ í”„ë‹¤", "5ì²œì›", "ì—†ë‹¤"],
#     "emotion": EmotionType.URGENT,
#     "detected_patterns": ["budget_constraint", "urgency"]
# }

# 3. ì»¨í…ìŠ¤íŠ¸ ë¡œë“œ (conversation_contexts í…Œì´ë¸”)
context = db.get_conversation_context(session_id, user_id)
```

### Phase 2: NLU ì²˜ë¦¬ (Intent + Entities ì¶”ì¶œ)
```python
# 4. NLU ìºì‹œ í™•ì¸ (nlu_training_data í…Œì´ë¸”)
cached_nlu = check_nlu_cache(preprocessed.normalized_text)

if not cached_nlu:
    # 5. Smart NLU Processing
    extracted_info = self._smart_nlu_processing(user_input, preprocessed)
    
    # 6. NLU ê²°ê³¼ ì €ì¥ (í•™ìŠµìš©)
    save_nlu_training_data(user_input.text, extracted_info)
```

### Phase 3: RAG ê²€ìƒ‰ ë° íŠ¹ì§• ì¶”ì¶œ
```python
# 7. RAG ìºì‹œ í™•ì¸ (rag_query_cache í…Œì´ë¸”)
query_hash = hash_query(extracted_info)
cached_results = get_rag_cache(query_hash)

if not cached_results:
    # 8. ì„ë² ë”© ìƒì„±/ì¡°íšŒ (embedding_cache í…Œì´ë¸”)
    query_embedding = get_or_create_embedding(user_input.text)
    
    # 9. ë²¡í„° ê²€ìƒ‰ ìˆ˜í–‰
    rag_results = perform_vector_search(query_embedding)
    save_rag_cache(query_hash, rag_results)

# 10. íŠ¹ì§• ì¶”ì¶œ (feature_vectors í…Œì´ë¸”)
features = extract_features(user_id, rag_results, extracted_info)
```

### Phase 4: ì¶”ì²œ ë° ì‘ë‹µ ìƒì„±
```python
# 11. ì¶”ì²œ íŠ¹ì§• ê³„ì‚° (recommendation_features í…Œì´ë¸”)
rec_features = calculate_recommendation_features(user_id, candidate_shops)

# 12. Wide&Deep ëª¨ë¸ ìŠ¤ì½”ì–´ë§
final_scores = wide_deep_model.predict(rec_features)

# 13. ì¿ í° ì ìš© (user_coupon_wallet í…Œì´ë¸”)
apply_coupons(recommendations, user_id)

# 14. ì‘ë‹µ ìƒì„± ë° ì„±ëŠ¥ ê¸°ë¡ (performance_logs í…Œì´ë¸”)
response = generate_response(recommendations)
log_performance(start_time, response_time, component_times)
```

---

## 4. í•µì‹¬ ë°ì´í„° í…Œì´ë¸”

### shops í…Œì´ë¸” (ê°€ê²Œ ì •ë³´) - í™•ì¥ ë²„ì „
```sql
CREATE TABLE shops (
    id INT PRIMARY KEY AUTO_INCREMENT,
    
    -- ğŸª [SAMPLE_DATA] ê¸°ë³¸ í•„ë“œ
    shop_name VARCHAR(200) NOT NULL,              
    category VARCHAR(100) NOT NULL,               -- 13ê°œ ì¹´í…Œê³ ë¦¬
    address_name TEXT,                            
    is_good_influence_shop BOOLEAN DEFAULT FALSE, 
    is_food_card_shop VARCHAR(10),               -- 'Y', 'N', 'P'(ë¶€ë¶„), 'U'(ë¯¸í™•ì¸)
    
    open_hour VARCHAR(10),                        -- "09:00" (24ì‹œê°„ í˜•ì‹)
    close_hour VARCHAR(10),                       -- "22:00"
    break_start_hour VARCHAR(10),                 
    break_end_hour VARCHAR(10),
    
    phone VARCHAR(20),                            
    owner_message TEXT,                           
    
    latitude DECIMAL(10, 8),                      
    longitude DECIMAL(11, 8),
    
    -- ğŸ”„ [DERIVED] ì‹¤ì‹œê°„ ìƒíƒœ
    current_status VARCHAR(20) DEFAULT 'UNKNOWN', -- OPEN/CLOSED/BREAK_TIME/UNKNOWN
    
    -- ğŸš€ [AI_COMPUTED] ì„±ëŠ¥ ì§€í‘œ
    recommendation_count INT DEFAULT 0,           -- ì´ ì¶”ì²œ íšŸìˆ˜
    click_through_rate DECIMAL(5,4) DEFAULT 0.0,  -- í´ë¦­ë¥  (0.0000~1.0000)
    conversion_rate DECIMAL(5,4) DEFAULT 0.0,     -- ì „í™˜ìœ¨ (ì‹¤ì œ ë°©ë¬¸/ì£¼ë¬¸)
    
    -- ğŸš€ [AI_COMPUTED] AI íŒŒìƒ íŠ¹ì§•
    popularity_score DECIMAL(4,3) DEFAULT 0.0,    -- ì¸ê¸°ë„ ì ìˆ˜ (0.000~1.000)
    quality_score DECIMAL(4,3) DEFAULT 0.0,       -- í’ˆì§ˆ ì ìˆ˜ (ë¦¬ë·° ê¸°ë°˜)
    user_satisfaction_avg DECIMAL(3,2) DEFAULT 0.0, -- í‰ê·  ë§Œì¡±ë„ (0.00~5.00)
    
    -- ğŸš€ [AI_COMPUTED] ìš´ì˜ ì§€í‘œ
    last_recommended TIMESTAMP,                   -- ë§ˆì§€ë§‰ ì¶”ì²œ ì‹œê°
    total_orders_served INT DEFAULT 0,            -- ì´ ì£¼ë¬¸ ì²˜ë¦¬ ìˆ˜
    avg_order_value DECIMAL(8,2) DEFAULT 0.0,    -- í‰ê·  ì£¼ë¬¸ ê¸ˆì•¡
    
    -- ğŸ” [AI_COMPUTED] ë²¡í„° ê²€ìƒ‰ìš©
    description_embedding JSON,                   -- ê°€ê²Œ ì„¤ëª… ì„ë² ë”© ë²¡í„°
    menu_summary_embedding JSON,                  -- ë©”ë‰´ ìš”ì•½ ì„ë² ë”©
    
    INDEX idx_category (category),
    INDEX idx_good_influence (is_good_influence_shop),
    INDEX idx_food_card (is_food_card_shop),
    INDEX idx_popularity (popularity_score),
    INDEX idx_quality (quality_score),
    INDEX idx_last_recommended (last_recommended)
);
```

### menus í…Œì´ë¸” (ë©”ë‰´ ì •ë³´) - í™•ì¥ ë²„ì „
```sql
CREATE TABLE menus (
    id INT PRIMARY KEY AUTO_INCREMENT,
    shop_id INT NOT NULL,                         
    
    -- ğŸª [SAMPLE_DATA] ê¸°ë³¸ ì •ë³´
    menu_name VARCHAR(200) NOT NULL,              
    price INT NOT NULL,                           
    description TEXT,                             
    category VARCHAR(100),                        -- ë©”ì¸ë©”ë‰´/ì„¸íŠ¸ë©”ë‰´/ì‚¬ì´ë“œë©”ë‰´/ìŒë£Œ/ë””ì €íŠ¸
    
    -- ğŸš€ [AI_COMPUTED] ML íŠ¹ì§•
    recommendation_frequency INT DEFAULT 0,       -- ì¶”ì²œëœ íšŸìˆ˜
    user_preference_score DECIMAL(4,3) DEFAULT 0.0, -- ì‚¬ìš©ì ì„ í˜¸ë„ ì ìˆ˜
    seasonal_popularity JSON,                     -- {"1ì›”": 0.8, "2ì›”": 0.6, ...}
    
    -- ğŸš€ [AI_COMPUTED] ì˜ì–‘ AI íŠ¹ì§•
    estimated_calories INT,                       -- ì¶”ì • ì¹¼ë¡œë¦¬
    healthiness_score DECIMAL(3,2),              -- ê±´ê°•ë„ ì ìˆ˜ (0.00~5.00)
    dietary_tags JSON,                           -- ["vegetarian", "spicy", "low-sodium"]
    
    -- ğŸ” [AI_COMPUTED] ë²¡í„° ê²€ìƒ‰ìš©
    description_embedding JSON,                   -- ë©”ë‰´ ì„¤ëª… ì„ë² ë”©
    ingredient_embedding JSON,                    -- ì¬ë£Œ ê¸°ë°˜ ì„ë² ë”©
    
    FOREIGN KEY (shop_id) REFERENCES shops(id),
    INDEX idx_shop (shop_id),
    INDEX idx_price (price),
    INDEX idx_preference_score (user_preference_score),
    INDEX idx_calories (estimated_calories)
);
```

### coupons í…Œì´ë¸” (ì¿ í° ì •ë³´) â­ ë‚˜ë¹„ì–Œ íŠ¹í™”
```sql
CREATE TABLE coupons (
    id VARCHAR(50) PRIMARY KEY,
    
    coupon_name VARCHAR(200) NOT NULL,            
    description TEXT,                             
    
    discount_amount INT,                          -- ì •ì•¡ í• ì¸ (ì›)
    discount_rate DECIMAL(3,2),                   -- ì •ë¥  í• ì¸ (0.00~1.00)
    min_order_amount INT,                         -- ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡
    
    usage_type VARCHAR(30),                       -- 'ALL', 'SHOP', 'CATEGORY', 'FOODCARD'
    target_categories JSON,                       -- ["í•œì‹", "ë¶„ì‹"]
    applicable_shops JSON,                        -- [1, 2, 3] shop_id ë¦¬ìŠ¤íŠ¸
    
    valid_from DATE,                              
    valid_until DATE,
    
    -- ğŸ”„ [DERIVED] í•„ë“œ
    is_active BOOLEAN DEFAULT TRUE,               
    priority_score DECIMAL(3,2),                  -- 0.00~1.00 ìš°ì„ ìˆœìœ„
    
    -- ğŸš€ [AI_COMPUTED] ì‚¬ìš© ë¶„ì„
    total_issued INT DEFAULT 0,                   -- ì´ ë°œê¸‰ ìˆ˜
    total_used INT DEFAULT 0,                     -- ì´ ì‚¬ìš© ìˆ˜
    avg_order_increase DECIMAL(8,2),              -- í‰ê·  ì£¼ë¬¸ì•¡ ì¦ê°€
    user_satisfaction_impact DECIMAL(3,2),        -- ë§Œì¡±ë„ ì˜í–¥ (0.00~5.00)
    
    INDEX idx_usage_type (usage_type),
    INDEX idx_active (is_active),
    INDEX idx_valid_dates (valid_from, valid_until)
);
```

### users í…Œì´ë¸” (ì¼ë°˜ ì‚¬ìš©ì) - í™•ì¥ ë²„ì „
```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    
    -- ğŸª [SAMPLE_DATA] ê¸°ë³¸ ì •ë³´
    name VARCHAR(100),                            
    nickname VARCHAR(100),                        
    birthday DATE,                                
    current_address TEXT,                         
    
    -- ğŸ”„ [DERIVED] í•„ë“œ
    age_group VARCHAR(20),                        -- '10ëŒ€', '20ëŒ€', '30ëŒ€' ë“±
    region_code VARCHAR(20),                      
    
    -- ğŸš€ [AI_COMPUTED] AI í•™ìŠµ íŠ¹ì§•
    interaction_patterns JSON,                    -- ìƒí˜¸ì‘ìš© íŒ¨í„´ ë¶„ì„
    -- {
    --   "peak_hours": [12, 18, 19],
    --   "preferred_days": ["Friday", "Saturday"],
    --   "avg_session_length": 180,
    --   "interaction_style": "quick_decision"
    -- }
    
    preference_evolution JSON,                    -- ì„ í˜¸ë„ ë³€í™” ì¶”ì 
    -- {
    --   "2024-01": {"í•œì‹": 0.7, "ì¤‘ì‹": 0.3},
    --   "2024-02": {"í•œì‹": 0.5, "ì¹˜í‚¨": 0.5}
    -- }
    
    context_preferences JSON,                     -- ìƒí™©ë³„ ì„ í˜¸ë„
    -- {
    --   "lunch": {"categories": ["í•œì‹", "ë¶„ì‹"], "budget": 8000},
    --   "dinner_with_friends": {"categories": ["ì¹˜í‚¨", "í”¼ì"], "budget": 15000}
    -- }
    
    -- ğŸš€ [AI_COMPUTED] ì°¸ì—¬ ì§€í‘œ
    session_frequency DECIMAL(4,2) DEFAULT 0.0,   -- ì£¼ê°„ í‰ê·  ì„¸ì…˜ ìˆ˜
    avg_session_duration INT DEFAULT 0,           -- í‰ê·  ì„¸ì…˜ ì‹œê°„(ì´ˆ)
    churn_probability DECIMAL(4,3) DEFAULT 0.0,   -- ì´íƒˆ í™•ë¥  (0.000~1.000)
    lifetime_value_score DECIMAL(6,2) DEFAULT 0.0, -- LTV ì ìˆ˜
    
    -- ğŸš€ [AI_COMPUTED] ê°œì¸í™” ìˆ˜ì¤€
    personalization_completeness DECIMAL(3,2) DEFAULT 0.0, -- í”„ë¡œí•„ ì™„ì„±ë„
    model_confidence DECIMAL(4,3) DEFAULT 0.0,    -- ëª¨ë¸ ì‹ ë¢°ë„
    
    INDEX idx_age_group (age_group),
    INDEX idx_churn_prob (churn_probability)
);
```

### foodcard_users í…Œì´ë¸” (ê¸‰ì‹ì¹´ë“œ ì‚¬ìš©ì) â­ ë‚˜ë¹„ì–Œ í•µì‹¬
```sql
CREATE TABLE foodcard_users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    
    user_id INT NOT NULL,                         
    card_number VARCHAR(50),                      
    balance INT DEFAULT 0,                        -- í˜„ì¬ ì”ì•¡
    status VARCHAR(20) DEFAULT 'ACTIVE',          -- ACTIVE/INACTIVE/SUSPENDED/EXPIRED
    
    -- ğŸ”„ [DERIVED] í•„ë“œ
    target_age_group VARCHAR(20),                 -- 'ì´ˆë“±í•™ìƒ', 'ì¤‘ê³ ë“±í•™ìƒ', 'ì²­ë…„'
    
    -- ğŸš€ [AI_COMPUTED] ì‚¬ìš© íŒ¨í„´
    monthly_usage_pattern JSON,                   -- ì›”ë³„ ì‚¬ìš© íŒ¨í„´
    -- {
    --   "week1": {"amount": 35000, "count": 7},
    --   "week2": {"amount": 30000, "count": 6},
    --   "week3": {"amount": 25000, "count": 5},
    --   "week4": {"amount": 10000, "count": 2}  -- ì›”ë§ ì”ì•¡ ë¶€ì¡±
    -- }
    
    balance_alert_sent BOOLEAN DEFAULT FALSE,     -- ì”ì•¡ ë¶€ì¡± ì•Œë¦¼ ë°œì†¡ ì—¬ë¶€
    emergency_coupon_eligible BOOLEAN DEFAULT TRUE, -- ê¸´ê¸‰ ì¿ í° ìê²©
    
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user (user_id),
    INDEX idx_status (status)
);
```

### product_orders í…Œì´ë¸” (ì£¼ë¬¸ ì´ë ¥)
```sql
CREATE TABLE product_orders (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    
    -- ğŸª [SAMPLE_DATA] ì£¼ë¬¸ ì •ë³´
    product_id INT,                               -- ì£¼ë¬¸ ìƒí’ˆ (ë©”ë‰´ ID)
    created_at TIMESTAMP,                         -- ì£¼ë¬¸ ì‹œê°„
    quantity INT,                                 -- ì£¼ë¬¸ ìˆ˜ëŸ‰
    price INT,                                    -- ì£¼ë¬¸ ê¸ˆì•¡
    
    -- ğŸ”„ [DERIVED] ì„ í˜¸ë„ í•™ìŠµìš©
    order_pattern_score DECIMAL(3,2),             -- ì£¼ë¬¸ íŒ¨í„´ ì ìˆ˜ (0.00~1.00)
    preference_weight DECIMAL(3,2),               -- ì„ í˜¸ë„ ê°€ì¤‘ì¹˜ (0.00~1.00)
    
    -- ğŸš€ [AI_COMPUTED] ì¶”ê°€ ë¶„ì„
    time_since_last_order INT,                    -- ì´ì „ ì£¼ë¬¸ê³¼ì˜ ê°„ê²©(ì¼)
    is_reorder BOOLEAN DEFAULT FALSE,             -- ì¬ì£¼ë¬¸ ì—¬ë¶€
    order_context VARCHAR(50),                    -- 'regular', 'exploration', 'emergency'
    
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user_time (user_id, created_at),
    INDEX idx_product (product_id),
    INDEX idx_pattern_score (order_pattern_score)
);
```

### user_coupon_wallet í…Œì´ë¸” (ì‚¬ìš©ì ì¿ í° ì§€ê°‘) â­ ì‹ ê·œ
```sql
CREATE TABLE user_coupon_wallet (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    user_id INT NOT NULL,
    coupon_id VARCHAR(50) NOT NULL,
    
    -- ì§€ê°‘ ê´€ë¦¬
    acquired_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expiry_date TIMESTAMP,
    usage_date TIMESTAMP NULL,
    status VARCHAR(20) DEFAULT 'ACTIVE',          -- 'ACTIVE', 'USED', 'EXPIRED'
    
    -- ì‚¬ìš© ì»¨í…ìŠ¤íŠ¸
    used_shop_id INT,
    used_menu_id INT,
    used_order_amount INT,
    discount_applied INT,
    
    -- íšë“ ê²½ë¡œ
    acquisition_source VARCHAR(50),               -- 'welcome_bonus', 'loyalty_reward', 'emergency_assist'
    acquisition_context JSON,                     -- íšë“ ìƒí™© ìƒì„¸ ì •ë³´
    
    -- ğŸš€ [AI_COMPUTED] ì‚¬ìš© ì˜ˆì¸¡
    usage_probability DECIMAL(4,3),               -- ì‚¬ìš© ê°€ëŠ¥ì„± (0.000~1.000)
    recommended_usage_date DATE,                  -- AI ì¶”ì²œ ì‚¬ìš©ì¼
    
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (coupon_id) REFERENCES coupons(id),
    UNIQUE KEY unique_user_coupon_active (user_id, coupon_id, status),
    INDEX idx_user_status (user_id, status),
    INDEX idx_expiry (expiry_date),
    INDEX idx_usage_prob (usage_probability)
);
```

---

## 5. AI ìš´ì˜ í…Œì´ë¸”

### conversations í…Œì´ë¸” (ëŒ€í™” ì´ë ¥)
```sql
CREATE TABLE conversations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- ğŸ¤– [CHATBOT_GENERATED] ê¸°ë³¸ ì •ë³´
    user_id VARCHAR(100) NOT NULL,                -- í”Œë«í¼ë³„ ë‹¤ì–‘í•œ ID ìˆ˜ìš©
    session_id VARCHAR(200) NOT NULL,             
    conversation_id VARCHAR(200),                 
    
    input_text TEXT NOT NULL,                     
    response_text TEXT NOT NULL,                  
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- ğŸ¤– [CHATBOT_GENERATED] NLU ì¶”ì¶œ ì •ë³´
    extracted_intent VARCHAR(50),                 -- 'food_request', 'budget_inquiry' ë“±
    intent_confidence DECIMAL(4,3),               -- 0.000~1.000
    extracted_entities JSON,                      -- {"food_type": "ì¹˜í‚¨", "budget": 5000}
    
    -- ğŸ¤– [CHATBOT_GENERATED] ëŒ€í™” ë§¥ë½
    user_strategy VARCHAR(30),                    -- onboarding/data_building/normal/urgent
    conversation_turn INT,                        
    previous_intent VARCHAR(50),                  
    
    -- ì„±ëŠ¥ ì§€í‘œ
    processing_time_ms INT,                       
    nlu_time_ms INT,                             
    response_time_ms INT,                        
    
    -- ğŸš€ [AI_COMPUTED] í’ˆì§ˆ ì§€í‘œ
    response_quality_score DECIMAL(4,3),          -- ì‘ë‹µ í’ˆì§ˆ ì ìˆ˜
    user_satisfaction_inferred DECIMAL(4,3),      -- ì¶”ë¡ ëœ ë§Œì¡±ë„
    conversation_coherence DECIMAL(4,3),          -- ëŒ€í™” ì¼ê´€ì„±
    
    INDEX idx_user_timestamp (user_id, timestamp),
    INDEX idx_session (session_id),
    INDEX idx_intent (extracted_intent)
);
```

### conversation_contexts í…Œì´ë¸” (ì„¸ì…˜ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬) ğŸ†•
```sql
CREATE TABLE conversation_contexts (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- ì»¨í…ìŠ¤íŠ¸ ì‹ë³„
    session_id VARCHAR(200) NOT NULL,
    user_id VARCHAR(100) NOT NULL,
    conversation_turn INT NOT NULL,
    
    -- ì»¨í…ìŠ¤íŠ¸ ë°ì´í„°
    context_data JSON NOT NULL,                   -- ì „ì²´ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸
    -- {
    --   "mentioned_shops": [1, 15, 23],
    --   "mentioned_categories": ["ì¹˜í‚¨", "í•œì‹"],
    --   "budget_constraints": [5000, 10000],
    --   "time_constraints": ["lunch", "now"],
    --   "dietary_restrictions": ["no_spicy"],
    --   "companion_info": "friends"
    -- }
    
    user_state JSON,                              -- í˜„ì¬ ì‚¬ìš©ì ìƒíƒœ
    -- {
    --   "strategy": "data_building_mode",
    --   "completeness": 0.65,
    --   "engagement_level": "high",
    --   "frustration_score": 0.2
    -- }
    
    extracted_patterns JSON,                      -- ì¶”ì¶œëœ ëŒ€í™” íŒ¨í„´
    -- {
    --   "decision_style": "exploratory",
    --   "price_sensitivity": "high",
    --   "brand_loyalty": "low"
    -- }
    
    -- ì»¨í…ìŠ¤íŠ¸ ë©”íƒ€ë°ì´í„°
    context_type VARCHAR(50),                     -- 'onboarding', 'data_building', 'normal', 'urgent'
    importance_score DECIMAL(3,2),                -- ì¤‘ìš”ë„ ì ìˆ˜ (0.00~1.00)
    
    -- ì‹œê°„ ê´€ë¦¬
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP,                         -- ì»¨í…ìŠ¤íŠ¸ ë§Œë£Œ ì‹œê°„
    
    INDEX idx_session_turn (session_id, conversation_turn),
    INDEX idx_user_timestamp (user_id, timestamp),
    INDEX idx_context_type (context_type)
);
```

### user_interactions í…Œì´ë¸” (ìƒì„¸ ìƒí˜¸ì‘ìš©)
```sql
CREATE TABLE user_interactions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- ğŸ¤– [CHATBOT_GENERATED] ê¸°ë³¸ ì •ë³´
    user_id VARCHAR(100) NOT NULL,                
    session_id VARCHAR(200),                      
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    interaction_type VARCHAR(30),                 
    -- 'text_input', 'selection', 'feedback', 'coupon_use', 'detail_view'
    -- 'scroll', 'hover', 'copy_info', 'share', 'bookmark'
    
    intent VARCHAR(50),                           
    entities JSON,                                
    
    user_selection JSON,                          
    -- {
    --   "shop_id": 15,
    --   "menu_ids": [201, 202],
    --   "coupon_id": "FOOD10",
    --   "final_price": 8000,
    --   "selection_time_ms": 3500,
    --   "alternatives_viewed": [14, 16]
    -- }
    
    -- ğŸ¤– [CHATBOT_GENERATED] í•™ìŠµìš© íŠ¹ì§•
    food_preference_extracted VARCHAR(100),       
    budget_pattern_extracted INT,                 
    companion_pattern_extracted VARCHAR(50),      
    
    coupon_usage JSON,                           
    satisfaction_score INT,                      -- 1-5ì 
    
    -- ğŸš€ [AI_COMPUTED] í–‰ë™ ë¶„ì„
    interaction_sequence_pattern VARCHAR(100),    -- ìƒí˜¸ì‘ìš© ìˆœì„œ íŒ¨í„´
    decision_confidence DECIMAL(4,3),             -- ê²°ì • í™•ì‹ ë„
    exploration_score DECIMAL(4,3),               -- íƒìƒ‰ ì„±í–¥ ì ìˆ˜
    
    INDEX idx_user_timestamp (user_id, timestamp),
    INDEX idx_interaction_type (interaction_type),
    INDEX idx_decision_confidence (decision_confidence)
);
```

### recommendations_log í…Œì´ë¸” (ì¶”ì²œ ë¡œê·¸)
```sql
CREATE TABLE recommendations_log (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- ğŸ¤– [CHATBOT_GENERATED] ê¸°ë³¸ ì •ë³´
    user_id VARCHAR(100) NOT NULL,                
    session_id VARCHAR(200),                      
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- ìš”ì²­ ì •ë³´
    request_intent VARCHAR(50),                   
    request_entities JSON,                        
    
    -- ğŸ”„ [DERIVED] ì¶”ì²œ ê²°ê³¼
    recommendations JSON NOT NULL,                
    -- [{
    --   "shop_id": 15,
    --   "shop_name": "ê¹€ë°¥ì²œêµ­",
    --   "score": 0.92,
    --   "ranking": 1,
    --   "reason": "ì˜ˆì‚°ì í•©+ê°€ê¹Œì›€+ì¸ê¸°ë©”ë‰´",
    --   "reason_breakdown": {
    --     "budget_fit": 0.95,
    --     "distance_score": 0.88,
    --     "popularity": 0.91,
    --     "personal_preference": 0.85
    --   },
    --   "applicable_coupons": ["FOOD10", "TEEN20"],
    --   "final_price_with_coupon": 3000
    -- }]
    
    recommendation_count INT NOT NULL,            
    recommendation_method VARCHAR(50),            -- wide_deep/rag/hybrid/emergency/coupon_based
    
    confidence_score DECIMAL(4,3),                
    total_discount_available INT,                 
    
    -- ğŸš€ [AI_COMPUTED] ì¶”ì²œ í’ˆì§ˆ
    diversity_score DECIMAL(4,3),                 -- ë‹¤ì–‘ì„± ì ìˆ˜
    personalization_score DECIMAL(4,3),           -- ê°œì¸í™” ì ìˆ˜
    relevance_score DECIMAL(4,3),                 -- ê´€ë ¨ì„± ì ìˆ˜
    novelty_score DECIMAL(4,3),                   -- ìƒˆë¡œì›€ ì ìˆ˜
    
    -- ì‚¬ìš©ì ë°˜ì‘
    user_viewed_details JSON,                     -- ìƒì„¸ ì¡°íšŒí•œ ì¶”ì²œ IDë“¤
    user_final_selection INT,                     -- ìµœì¢… ì„ íƒí•œ shop_id
    time_to_decision_ms INT,                      -- ê²°ì •ê¹Œì§€ ê±¸ë¦° ì‹œê°„
    
    INDEX idx_user_timestamp (user_id, timestamp),
    INDEX idx_method (recommendation_method),
    INDEX idx_personalization (personalization_score)
);
```

---

## 6. ì„±ëŠ¥ ìµœì í™” í…Œì´ë¸”

### performance_logs í…Œì´ë¸” (ì‹œìŠ¤í…œ ì„±ëŠ¥ ì¶”ì ) ğŸ†•
```sql
CREATE TABLE performance_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- ì„±ëŠ¥ ë©”íŠ¸ë¦­
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    operation_type VARCHAR(50) NOT NULL,          -- 'nlu_processing', 'rag_search', 'recommendation', 'response_generation'
    
    -- ì‹œê°„ ì¸¡ì • (ë°€ë¦¬ì´ˆ)
    processing_time_ms INT,
    nlu_time_ms INT,
    rag_time_ms INT,
    recommendation_time_ms INT,
    response_generation_time_ms INT,
    total_time_ms INT,
    
    -- ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
    memory_usage_mb FLOAT,
    cpu_usage_percent FLOAT,
    gpu_usage_percent FLOAT,
    cache_hit_rate DECIMAL(4,3),                  -- ìºì‹œ íˆíŠ¸ìœ¨ (0.000~1.000)
    
    -- í’ˆì§ˆ ë©”íŠ¸ë¦­
    confidence_score DECIMAL(4,3),
    success BOOLEAN DEFAULT TRUE,
    error_type VARCHAR(100),
    error_message TEXT,
    
    -- ì»¨í…ìŠ¤íŠ¸
    user_id VARCHAR(100),
    session_id VARCHAR(200),
    request_complexity VARCHAR(20),               -- 'simple', 'moderate', 'complex'
    
    -- ë³‘ëª© ì§€ì  ë¶„ì„
    bottleneck_component VARCHAR(50),             -- ê°€ì¥ ëŠë¦° ì»´í¬ë„ŒíŠ¸
    optimization_suggestions JSON,                -- AIê°€ ì œì•ˆí•˜ëŠ” ìµœì í™” ë°©ë²•
    
    INDEX idx_timestamp (timestamp),
    INDEX idx_operation_type (operation_type),
    INDEX idx_user_session (user_id, session_id),
    INDEX idx_total_time (total_time_ms)
);
```

### rag_query_cache í…Œì´ë¸” (RAG ì„±ëŠ¥ ìµœì í™”) ğŸ†•
```sql
CREATE TABLE rag_query_cache (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- ì¿¼ë¦¬ ì •ë³´
    query_hash VARCHAR(64) NOT NULL UNIQUE,       -- SHA-256 of normalized query
    original_query TEXT NOT NULL,
    normalized_query TEXT NOT NULL,
    
    -- RAG ê²°ê³¼
    retrieved_documents JSON,                     -- ë¬¸ì„œ IDì™€ ì ìˆ˜
    -- [{
    --   "doc_id": "shop_15_desc",
    --   "score": 0.89,
    --   "type": "shop_description"
    -- }]
    
    vector_search_results JSON,                   -- ë²¡í„° ê²€ìƒ‰ ê²°ê³¼
    semantic_similarity_scores JSON,              -- ì˜ë¯¸ì  ìœ ì‚¬ë„ ì ìˆ˜
    
    -- ì„±ëŠ¥ ë°ì´í„°
    search_time_ms INT,
    total_documents_searched INT,
    cache_hit_count INT DEFAULT 0,
    avg_response_time_ms INT,                     -- í‰ê·  ì‘ë‹µ ì‹œê°„
    
    -- ìºì‹œ ê´€ë¦¬
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_accessed TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    access_count INT DEFAULT 1,
    ttl_seconds INT DEFAULT 3600,                 -- Time To Live
    
    -- í’ˆì§ˆ ì§€í‘œ
    result_quality_score DECIMAL(4,3),            -- ê²°ê³¼ í’ˆì§ˆ ì ìˆ˜
    user_satisfaction_rate DECIMAL(4,3),          -- ì‚¬ìš©ì ë§Œì¡±ë¥ 
    
    INDEX idx_query_hash (query_hash),
    INDEX idx_created (created_at),
    INDEX idx_last_accessed (last_accessed),
    INDEX idx_access_count (access_count)
);
```

### embedding_cache í…Œì´ë¸” (ë²¡í„° ìºì‹±) ğŸ†•
```sql
CREATE TABLE embedding_cache (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- ì»¨í…ì¸  ì‹ë³„
    content_hash VARCHAR(64) NOT NULL UNIQUE,     -- SHA-256 í•´ì‹œ
    content_type VARCHAR(50) NOT NULL,            -- 'query', 'shop_description', 'menu_description', 'user_review'
    original_content TEXT NOT NULL,
    
    -- ì„ë² ë”© ë°ì´í„°
    embedding_vector JSON NOT NULL,               -- ì„ë² ë”© ë²¡í„° (ì˜ˆ: 768ì°¨ì›)
    embedding_model VARCHAR(100),                 -- 'sentence-transformers/xlm-r-100langs-bert-base-nli-stsb-mean-tokens'
    embedding_dimension INT,                      -- ë²¡í„° ì°¨ì›
    
    -- ìºì‹œ ê´€ë¦¬
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_accessed TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    access_count INT DEFAULT 1,
    computation_time_ms INT,                      -- ìƒì„± ì‹œê°„
    
    -- í’ˆì§ˆ ê´€ë¦¬
    vector_norm FLOAT,                           -- ë²¡í„° ë…¸ë¦„ (í’ˆì§ˆ ì²´í¬ìš©)
    is_valid BOOLEAN DEFAULT TRUE,               -- ìœ íš¨ì„± ê²€ì¦
    
    INDEX idx_content_hash (content_hash),
    INDEX idx_content_type (content_type),
    INDEX idx_last_accessed (last_accessed),
    INDEX idx_model (embedding_model)
);
```

---

## 7. ML íŠ¹ì§• ë° í•™ìŠµ í…Œì´ë¸”

### feature_vectors í…Œì´ë¸” (ML íŠ¹ì§• ì €ì¥) ğŸ†•
```sql
CREATE TABLE feature_vectors (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- ì—”í‹°í‹° ì •ë³´
    entity_type VARCHAR(50) NOT NULL,             -- 'user', 'shop', 'menu', 'interaction'
    entity_id VARCHAR(100) NOT NULL,
    
    -- ë²¡í„° ë°ì´í„°
    feature_vector_dense JSON,                    -- Dense features for Wide&Deep
    -- {
    --   "avg_order_value": 0.65,
    --   "visit_frequency": 0.82,
    --   "price_sensitivity": 0.91,
    --   "category_diversity": 0.45
    -- }
    
    feature_vector_sparse JSON,                   -- Sparse categorical features
    -- {
    --   "preferred_categories": ["í•œì‹", "ì¤‘ì‹"],
    --   "preferred_time_slots": ["lunch", "dinner"],
    --   "dietary_restrictions": ["no_spicy"]
    -- }
    
    embedding_vector JSON,                        -- Learned embeddings (ì˜ˆ: 128ì°¨ì›)
    
    -- íŠ¹ì§• ì—”ì§€ë‹ˆì–´ë§ ì»¨í…ìŠ¤íŠ¸
    feature_extraction_method VARCHAR(100),       -- 'rule_based', 'ml_derived', 'hybrid'
    feature_version VARCHAR(20),                  -- ë²„ì „ ê´€ë¦¬
    confidence_score DECIMAL(4,3),               
    
    -- ì‹œê°„ ì •ë³´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    valid_until TIMESTAMP,                        -- ìœ íš¨ ê¸°ê°„
    
    -- íŠ¹ì§• ì¤‘ìš”ë„
    feature_importance JSON,                      -- ê° íŠ¹ì§•ì˜ ì¤‘ìš”ë„
    -- {
    --   "avg_order_value": 0.85,
    --   "visit_frequency": 0.72,
    --   "price_sensitivity": 0.93
    -- }
    
    INDEX idx_entity (entity_type, entity_id),
    INDEX idx_version (feature_version),
    INDEX idx_created (created_at),
    INDEX idx_valid_until (valid_until)
);
```

### recommendation_features í…Œì´ë¸” (ì¶”ì²œ íŠ¹ì§• ìƒì„¸) ğŸ†•
```sql
CREATE TABLE recommendation_features (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- ì¶”ì²œ ì»¨í…ìŠ¤íŠ¸
    user_id VARCHAR(100) NOT NULL,
    shop_id INT NOT NULL,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- Layer 1 Features (Funnel Scores)
    collaborative_score DECIMAL(4,3),             -- í˜‘ì—… í•„í„°ë§ ì ìˆ˜
    content_score DECIMAL(4,3),                   -- ì½˜í…ì¸  ê¸°ë°˜ ì ìˆ˜
    contextual_score DECIMAL(4,3),                -- ì»¨í…ìŠ¤íŠ¸ ì ìˆ˜
    popularity_score DECIMAL(4,3),                -- ì¸ê¸°ë„ ì ìˆ˜
    
    -- Wide Features (Engineered)
    category_preference_match DECIMAL(4,3),       -- ì¹´í…Œê³ ë¦¬ ì„ í˜¸ë„ ë§¤ì¹­
    budget_compatibility DECIMAL(4,3),            -- ì˜ˆì‚° ì í•©ë„
    distance_penalty DECIMAL(4,3),                -- ê±°ë¦¬ í˜ë„í‹°
    time_preference_match DECIMAL(4,3),           -- ì‹œê°„ëŒ€ ì„ í˜¸ë„ ë§¤ì¹­
    visited_before BOOLEAN,                       -- ì´ì „ ë°©ë¬¸ ì—¬ë¶€
    similar_user_liked DECIMAL(4,3),              -- ìœ ì‚¬ ì‚¬ìš©ì ì„ í˜¸ë„
    
    -- Deep Features (Numerical)
    user_avg_budget_normalized DECIMAL(4,3),      -- ì •ê·œí™”ëœ í‰ê·  ì˜ˆì‚°
    user_favorite_count_normalized DECIMAL(4,3),  -- ì •ê·œí™”ëœ ì¦ê²¨ì°¾ê¸° ìˆ˜
    shop_rating_normalized DECIMAL(4,3),          -- ì •ê·œí™”ëœ ê°€ê²Œ í‰ì 
    shop_review_count_normalized DECIMAL(4,3),    -- ì •ê·œí™”ëœ ë¦¬ë·° ìˆ˜
    distance_normalized DECIMAL(4,3),             -- ì •ê·œí™”ëœ ê±°ë¦¬
    
    -- Cross Features (êµì°¨ íŠ¹ì§•)
    user_category_interaction DECIMAL(4,3),       -- user Ã— category ìƒí˜¸ì‘ìš©
    budget_time_interaction DECIMAL(4,3),         -- budget Ã— time ìƒí˜¸ì‘ìš©
    location_category_interaction DECIMAL(4,3),   -- location Ã— category ìƒí˜¸ì‘ìš©
    
    -- ìµœì¢… ì˜ˆì¸¡
    predicted_score DECIMAL(4,3),                 -- Wide&Deep ëª¨ë¸ ì˜ˆì¸¡ ì ìˆ˜
    ranking_position INT,                         -- ìµœì¢… ìˆœìœ„
    
    -- ì„¤ëª… ê°€ëŠ¥ì„±
    feature_contributions JSON,                   -- ê° íŠ¹ì§•ì˜ ê¸°ì—¬ë„
    -- {
    --   "category_preference_match": 0.25,
    --   "budget_compatibility": 0.18,
    --   "distance_penalty": -0.12,
    --   "popularity_score": 0.15
    -- }
    
    FOREIGN KEY (shop_id) REFERENCES shops(id),
    INDEX idx_user_timestamp (user_id, timestamp),
    INDEX idx_shop_score (shop_id, predicted_score),
    INDEX idx_ranking (ranking_position)
);
```

### nlu_training_data í…Œì´ë¸” (NLU í•™ìŠµ ë°ì´í„°) ğŸ†•
```sql
CREATE TABLE nlu_training_data (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- ì…ë ¥ ë°ì´í„°
    input_text TEXT NOT NULL,
    normalized_text TEXT,
    
    -- NLU ì¶œë ¥
    predicted_intent VARCHAR(50),
    intent_confidence DECIMAL(4,3),
    extracted_entities JSON,
    
    -- Ground Truth (í•™ìŠµìš©)
    true_intent VARCHAR(50),
    true_entities JSON,
    
    -- í’ˆì§ˆ ë©”íŠ¸ë¦­
    prediction_accuracy DECIMAL(4,3),             -- ì˜ˆì¸¡ ì •í™•ë„
    entity_extraction_f1 DECIMAL(4,3),            -- ì—”í‹°í‹° ì¶”ì¶œ F1 ì ìˆ˜
    
    -- í•™ìŠµ ì»¨í…ìŠ¤íŠ¸
    user_id VARCHAR(100),
    feedback_provided BOOLEAN DEFAULT FALSE,      -- ì‚¬ìš©ì í”¼ë“œë°± ì—¬ë¶€
    correction_applied BOOLEAN DEFAULT FALSE,     -- ìˆ˜ì • ì ìš© ì—¬ë¶€
    
    -- ë°ì´í„° ê´€ë¦¬
    data_source VARCHAR(50),                      -- 'user_interaction', 'synthetic', 'corrected', 'augmented'
    quality_score DECIMAL(3,2),                   -- ë°ì´í„° í’ˆì§ˆ ì ìˆ˜
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- í•™ìŠµ ìƒíƒœ
    used_for_training BOOLEAN DEFAULT FALSE,      -- í•™ìŠµì— ì‚¬ìš©ë¨
    training_batch_id VARCHAR(100),               -- í•™ìŠµ ë°°ì¹˜ ID
    model_version VARCHAR(20),                    -- ì‚¬ìš©ëœ ëª¨ë¸ ë²„ì „
    
    INDEX idx_intent (predicted_intent),
    INDEX idx_quality (quality_score),
    INDEX idx_created (created_at),
    INDEX idx_training_status (used_for_training)
);
```

### model_training_logs í…Œì´ë¸” (LoRA í›ˆë ¨ ê´€ë¦¬) ğŸ†•
```sql
CREATE TABLE model_training_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- í›ˆë ¨ ì„¸ì…˜ ì •ë³´
    training_session_id VARCHAR(200) NOT NULL,
    model_type VARCHAR(50),                       -- 'lora_adapter', 'base_model', 'embeddings'
    training_start_time TIMESTAMP,
    training_end_time TIMESTAMP,
    
    -- í›ˆë ¨ ì„¤ì •
    model_name VARCHAR(200),                      -- 'beomi/KoAlpaca-Polyglot-5.8B'
    lora_rank INT,                               -- 8, 16, 32
    lora_alpha INT,                              -- 16, 32
    lora_dropout DECIMAL(3,2),                   -- 0.05
    learning_rate DECIMAL(10,8),                 -- 0.0001
    batch_size INT,                              -- 4, 8, 16
    epochs INT,                                  -- 3, 5, 10
    
    -- í›ˆë ¨ ì§„í–‰
    current_epoch INT,
    current_step INT,
    total_steps INT,
    training_loss DECIMAL(10,6),
    validation_loss DECIMAL(10,6),
    best_validation_loss DECIMAL(10,6),
    
    -- ë°ì´í„° í’ˆì§ˆ
    training_samples_count INT,
    validation_samples_count INT,
    data_quality_score DECIMAL(3,2),
    class_balance JSON,                          -- í´ë˜ìŠ¤ë³„ ìƒ˜í”Œ ìˆ˜
    
    -- ëª¨ë¸ ì„±ëŠ¥
    final_model_path VARCHAR(500),
    checkpoint_paths JSON,                       -- ì²´í¬í¬ì¸íŠ¸ ê²½ë¡œë“¤
    evaluation_metrics JSON,                     -- í‰ê°€ ì§€í‘œ
    -- {
    --   "accuracy": 0.92,
    --   "f1_score": 0.89,
    --   "precision": 0.91,
    --   "recall": 0.87
    -- }
    
    deployment_status VARCHAR(50),               -- 'training', 'completed', 'deployed', 'failed'
    deployment_timestamp TIMESTAMP,
    
    -- ë¦¬ì†ŒìŠ¤ ì‚¬ìš©
    gpu_hours DECIMAL(10,2),
    peak_memory_gb FLOAT,
    
    INDEX idx_session (training_session_id),
    INDEX idx_status (deployment_status),
    INDEX idx_model_type (model_type)
);
```

---

## 8. ë¶„ì„ ë° ëª¨ë‹ˆí„°ë§ í…Œì´ë¸”

### user_journey_analytics í…Œì´ë¸” (ì‚¬ìš©ì ì—¬ì • ë¶„ì„) ğŸ†•
```sql
CREATE TABLE user_journey_analytics (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- ì—¬ì • ì‹ë³„
    user_id VARCHAR(100) NOT NULL,
    journey_session_id VARCHAR(200),
    journey_start TIMESTAMP,
    journey_end TIMESTAMP,
    
    -- ì—¬ì • ë‹¨ê³„
    onboarding_completed BOOLEAN DEFAULT FALSE,
    first_recommendation_received BOOLEAN DEFAULT FALSE,
    first_selection_made BOOLEAN DEFAULT FALSE,
    personalization_achieved BOOLEAN DEFAULT FALSE,
    
    -- ì—¬ì • ë©”íŠ¸ë¦­
    total_interactions INT DEFAULT 0,
    successful_recommendations INT DEFAULT 0,
    recommendation_acceptance_rate DECIMAL(4,3),
    average_session_duration INT,                 -- ì´ˆ ë‹¨ìœ„
    
    -- ì „í™˜ í¼ë„
    funnel_stage VARCHAR(50),                     -- 'awareness', 'interest', 'consideration', 'conversion', 'retention'
    conversion_probability DECIMAL(4,3),
    drop_off_point VARCHAR(100),                 -- ì´íƒˆ ì§€ì 
    
    -- ì‚¬ìš©ì ë§Œì¡±ë„
    satisfaction_signals JSON,                    -- ë§Œì¡±ë„ ì‹ í˜¸
    -- {
    --   "positive_feedback_count": 5,
    --   "negative_feedback_count": 1,
    --   "avg_response_time": 2.3,
    --   "reengagement_rate": 0.8
    -- }
    
    -- ê°œì¸í™” ì§„í–‰ë„
    personalization_milestones JSON,              -- ê°œì¸í™” ë§ˆì¼ìŠ¤í†¤
    -- {
    --   "preferences_identified": true,
    --   "budget_pattern_learned": true,
    --   "time_preference_detected": false,
    --   "companion_patterns_found": true
    -- }
    
    INDEX idx_user_journey (user_id, journey_session_id),
    INDEX idx_funnel_stage (funnel_stage),
    INDEX idx_journey_start (journey_start)
);
```

### user_profiles í…Œì´ë¸” (ì¢…í•© í”„ë¡œí•„) ğŸ†•
```sql
CREATE TABLE user_profiles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    -- ğŸ¤– [CHATBOT_GENERATED] í•„ë“œ
    user_id VARCHAR(100) PRIMARY KEY,             
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    -- ğŸ¤– [CHATBOT_GENERATED] ê°œì¸í™” ì •ë³´
    preferred_categories JSON,                    -- ["ì¹˜í‚¨", "í•œì‹", "ë¶„ì‹"]
    average_budget INT,                           
    good_influence_preference DECIMAL(3,2),       -- ì°©í•œê°€ê²Œ ì„ í˜¸ë„
    interaction_count INT DEFAULT 0,              
    
    -- ğŸ”„ [DERIVED] í•„ë“œ
    favorite_shops JSON,                          -- [15, 23, 45]
    recent_orders JSON,                           -- ìµœê·¼ 10ê°œ ì£¼ë¬¸
    coupon_preference JSON,                       -- ì¿ í° ì‚¬ìš© íŒ¨í„´
    monthly_stats JSON,                           -- ì›”ë³„ í†µê³„
    
    -- ğŸš€ [AI_COMPUTED] ê³ ê¸‰ í”„ë¡œí•„
    personality_type VARCHAR(50),                 -- 'explorer', 'loyalist', 'deal_seeker', 'convenience_first'
    decision_making_speed VARCHAR(20),            -- 'quick', 'moderate', 'deliberate'
    price_elasticity DECIMAL(4,3),               -- ê°€ê²© ë¯¼ê°ë„
    brand_loyalty_score DECIMAL(4,3),            -- ë¸Œëœë“œ ì¶©ì„±ë„
    
    -- ğŸš€ [AI_COMPUTED] ì˜ˆì¸¡ ëª¨ë¸
    next_order_prediction JSON,                   -- ë‹¤ìŒ ì£¼ë¬¸ ì˜ˆì¸¡
    -- {
    --   "predicted_date": "2024-02-15",
    --   "predicted_category": "ì¹˜í‚¨",
    --   "predicted_budget": 15000,
    --   "confidence": 0.78
    -- }
    
    churn_risk_factors JSON,                      -- ì´íƒˆ ìœ„í—˜ ìš”ì¸
    -- {
    --   "last_order_days_ago": 15,
    --   "satisfaction_declining": true,
    --   "budget_constraints_increasing": true
    -- }
    
    INDEX idx_updated (last_updated),
    INDEX idx_personality (personality_type)
);
```

---

## 9. Intentì™€ Entities ë¶„ë¦¬ ì„¤ê³„

### Intent (ì˜ë„) - "ì‚¬ìš©ìê°€ ë¬´ì—‡ì„ í•˜ë ¤ê³  í•˜ëŠ”ê°€?"
```python
IntentType = {
    'food_request': 'íŠ¹ì • ìŒì‹ ì¶”ì²œ ìš”ì²­',      # "ì¹˜í‚¨ ë¨¹ê³  ì‹¶ì–´"
    'budget_inquiry': 'ì˜ˆì‚° ì œì•½ ìŒì‹ ì°¾ê¸°',    # "5ì²œì›ìœ¼ë¡œ ë­ ë¨¹ì§€?"
    'coupon_inquiry': 'ì¿ í° ì •ë³´ ë¬¸ì˜',        # "í• ì¸ ì¿ í° ìˆì–´?"
    'location_inquiry': 'ìœ„ì¹˜ ê¸°ë°˜ ê²€ìƒ‰',       # "ê·¼ì²˜ ë§›ì§‘ ì•Œë ¤ì¤˜"
    'time_inquiry': 'ì˜ì—…ì‹œê°„ ê´€ë ¨ ë¬¸ì˜',       # "ì§€ê¸ˆ ì—´ë¦° ê³³ ìˆì–´?"
    'general_chat': 'ì¼ë°˜ ëŒ€í™”',              # "ì•ˆë…•í•˜ì„¸ìš”"
    'menu_option': 'ë©”ë‰´ ì˜µì…˜ ë¬¸ì˜',           # "ë§¤ìš´ê±° ë¹¼ê³ "
    'emergency_food': 'ê¸´ê¸‰ ì‹ì‚¬ í•„ìš”',        # "ì§€ê¸ˆ ë‹¹ì¥ ë¨¹ì„ ìˆ˜ ìˆëŠ”"
    'group_dining': 'ë‹¨ì²´ ì‹ì‚¬ ë¬¸ì˜',          # "10ëª…ì´ ë¨¹ì„ ìˆ˜ ìˆëŠ”"
}
```

### Entities (ì—”í‹°í‹°) - "êµ¬ì²´ì ì¸ ì •ë³´ëŠ” ë¬´ì—‡ì¸ê°€?"
```python
@dataclass
class ExtractedEntity:
    food_type: Optional[str] = None        # "ì¹˜í‚¨", "í•œì‹", "í”¼ì"
    budget: Optional[int] = None           # 5000, 10000, 15000
    location_preference: Optional[str] = None  # "ê·¼ì²˜", "ê°•ë‚¨ì—­", "5ë¶„ ê±°ë¦¬"
    time_preference: Optional[str] = None   # "ì§€ê¸ˆ", "ì ì‹¬ì‹œê°„", "ì €ë…"
    taste_preference: Optional[str] = None  # "ë§¤ìš´", "ìˆœí•œ", "ì§­ì§¤í•œ"
    companions: Optional[str] = None        # "í˜¼ì", "ì¹œêµ¬", "ê°€ì¡±"
    urgency: Optional[str] = None          # "high", "normal", "low"
    dietary_restrictions: Optional[List[str]] = None  # ["vegetarian", "halal", "no_pork"]
    portion_size: Optional[str] = None     # "large", "normal", "small"
```

---

## 10. ë°ì´í„° ì €ì¥ ì „ëµ

### ğŸ—„ï¸ DBì— ë°˜ë“œì‹œ ì €ì¥í•´ì•¼ í•˜ëŠ” ë°ì´í„°

#### í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°
1. **ëŒ€í™” ê¸°ë¡** (conversations) - ë²•ì  ìš”êµ¬ì‚¬í•­, í•™ìŠµ ë°ì´í„°
2. **ì‚¬ìš©ì í”„ë¡œí•„** (user_profiles) - ì¥ê¸° ê°œì¸í™”
3. **ì¶”ì²œ ë¡œê·¸** (recommendations_log) - A/B í…ŒìŠ¤íŠ¸, ì„±ëŠ¥ í‰ê°€
4. **ì£¼ë¬¸ ì´ë ¥** (product_orders) - ë§¤ì¶œ ë¶„ì„, íŒ¨í„´ í•™ìŠµ
5. **ì¿ í° ì‚¬ìš©** (user_coupon_wallet) - ì¬ë¬´ ì¶”ì , ë§ˆì¼€íŒ… ë¶„ì„

#### ML/AI í•„ìˆ˜ ë°ì´í„°
1. **í•™ìŠµ ë°ì´í„°** (nlu_training_data) - ëª¨ë¸ ê°œì„ 
2. **íŠ¹ì§• ë²¡í„°** (feature_vectors) - ì¬í•™ìŠµ ì‹œ í•„ìš”
3. **ëª¨ë¸ í›ˆë ¨ ë¡œê·¸** (model_training_logs) - ë²„ì „ ê´€ë¦¬
4. **ì‚¬ìš©ì ì—¬ì •** (user_journey_analytics) - ì¥ê¸° í–‰ë™ ë¶„ì„

### ğŸ’¾ ë©”ëª¨ë¦¬/ìºì‹œì— ë³´ê´€ ê°€ëŠ¥í•œ ë°ì´í„°

#### ì‹¤ì‹œê°„ ê³„ì‚° ë°ì´í„°
1. **í˜„ì¬ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸** - Redis, TTL 24ì‹œê°„
2. **ì‹¤ì‹œê°„ ì¶”ì²œ ì ìˆ˜** - ë©”ëª¨ë¦¬, ì„¸ì…˜ ì¢…ë£Œ ì‹œ ì‚­ì œ
3. **ì„ì‹œ NLU ê²°ê³¼** - ë©”ëª¨ë¦¬, 5ë¶„ TTL

#### ìì£¼ ì ‘ê·¼í•˜ëŠ” ìºì‹œ ë°ì´í„°
1. **ì„ë² ë”© ë²¡í„°** (embedding_cache) - Redis, TTL 7ì¼
2. **RAG ê²€ìƒ‰ ê²°ê³¼** (rag_query_cache) - Redis, TTL 1ì‹œê°„
3. **ì¸ê¸° ê°€ê²Œ ëª©ë¡** - ë©”ëª¨ë¦¬, 10ë¶„ ê°±ì‹ 

### ğŸ”„ í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ ë°©ì‹

```python
# ìºì‹œ ê³„ì¸µ êµ¬ì¡°
CACHE_HIERARCHY = {
    'L1_Memory': {
        'conversation_context': 300,      # 5ë¶„
        'active_recommendations': 600,    # 10ë¶„
        'user_state': 1800               # 30ë¶„
    },
    'L2_Redis': {
        'user_profile': 3600,            # 1ì‹œê°„
        'shop_embeddings': 86400,        # 24ì‹œê°„
        'popular_queries': 7200          # 2ì‹œê°„
    },
    'L3_Database': {
        'conversations': None,           # ì˜êµ¬ ì €ì¥
        'recommendations_log': None,     # ì˜êµ¬ ì €ì¥
        'user_interactions': None        # ì˜êµ¬ ì €ì¥
    }
}
```

---

## 11. íŒŒìƒ í•„ë“œ ë° íŠ¹ì§• ì—”ì§€ë‹ˆì–´ë§

### ì‚¬ìš©ì ë ˆë²¨ íŠ¹ì§•
```python
def extract_user_features(user_id):
    return {
        # ê¸°ë³¸ í†µê³„
        'total_orders': count_user_orders(user_id),
        'avg_order_value': calculate_avg_order_value(user_id),
        'order_frequency': calculate_order_frequency(user_id),
        
        # ì‹œê°„ íŒ¨í„´
        'preferred_meal_times': extract_meal_time_preference(user_id),
        'weekend_vs_weekday': calculate_weekend_ratio(user_id),
        'time_consistency': measure_order_time_consistency(user_id),
        
        # ë‹¤ì–‘ì„± ì§€í‘œ
        'category_diversity': calculate_category_entropy(user_id),
        'shop_loyalty': measure_shop_repeat_rate(user_id),
        'exploration_tendency': calculate_new_shop_ratio(user_id),
        
        # ê°€ê²© ë¯¼ê°ë„
        'price_elasticity': measure_price_sensitivity(user_id),
        'discount_responsiveness': calculate_coupon_usage_rate(user_id),
        'budget_variability': measure_budget_std(user_id)
    }
```

### ê°€ê²Œ ë ˆë²¨ íŠ¹ì§•
```python
def extract_shop_features(shop_id):
    return {
        # ì¸ê¸°ë„ ì§€í‘œ
        'overall_popularity': calculate_order_count_percentile(shop_id),
        'recent_popularity_trend': measure_recent_growth(shop_id),
        'repeat_customer_rate': calculate_repeat_rate(shop_id),
        
        # í’ˆì§ˆ ì§€í‘œ
        'avg_rating': calculate_weighted_rating(shop_id),
        'rating_consistency': measure_rating_variance(shop_id),
        'complaint_rate': calculate_negative_feedback_rate(shop_id),
        
        # ìš´ì˜ íš¨ìœ¨ì„±
        'order_fulfillment_rate': measure_success_rate(shop_id),
        'peak_hour_performance': analyze_rush_hour_metrics(shop_id),
        'menu_availability': calculate_menu_stockout_rate(shop_id)
    }
```

### ìƒí˜¸ì‘ìš© ë ˆë²¨ íŠ¹ì§•
```python
def extract_interaction_features(user_id, shop_id, context):
    return {
        # ë§¤ì¹­ ì ìˆ˜
        'category_preference_match': match_user_shop_category(user_id, shop_id),
        'price_range_compatibility': check_budget_fit(user_id, shop_id),
        'distance_feasibility': calculate_distance_score(user_id, shop_id),
        
        # ì»¨í…ìŠ¤íŠ¸ íŠ¹ì§•
        'time_appropriateness': match_current_time_with_preference(context.time),
        'weather_menu_match': correlate_weather_with_menu(context.weather),
        'companion_suitability': evaluate_group_dining_fit(context.companions),
        
        # ì´ë ¥ ê¸°ë°˜
        'previous_satisfaction': get_historical_rating(user_id, shop_id),
        'reorder_probability': calculate_reorder_likelihood(user_id, shop_id),
        'time_since_last_order': days_since_last_order(user_id, shop_id)
    }
```

---

## 12. ì‹¤ì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: "ë°°ê³ í”ˆë° 5ì²œì›ë°–ì— ì—†ì–´" (ê¸´ê¸‰ + ì˜ˆì‚° ì œì•½)

#### 1ë‹¨ê³„: NLU ì²˜ë¦¬ ë° ìºì‹±
```python
# nlu_training_data í…Œì´ë¸” ì¡°íšŒ
cached = db.query("""
    SELECT predicted_intent, extracted_entities 
    FROM nlu_training_data 
    WHERE normalized_text = ? AND quality_score > 0.8
""", normalized_input)

if not cached:
    # ìƒˆë¡œìš´ NLU ì²˜ë¦¬
    intent = 'budget_inquiry'
    entities = {"budget": 5000, "urgency": "high"}
    
    # í•™ìŠµ ë°ì´í„° ì €ì¥
    save_nlu_training_data(input_text, intent, entities)
```

#### 2ë‹¨ê³„: íŠ¹ì§• ì¶”ì¶œ ë° ì¶”ì²œ
```python
# feature_vectors í…Œì´ë¸”ì—ì„œ ì‚¬ìš©ì íŠ¹ì§• ë¡œë“œ
user_features = load_user_features(user_id)

# recommendation_features ê³„ì‚°
for shop in candidate_shops:
    features = calculate_recommendation_features(user_id, shop.id)
    
    # ê¸´ê¸‰ ëª¨ë“œ ê°€ì¤‘ì¹˜ ì ìš©
    if user_strategy == 'urgent_mode':
        features.distance_penalty *= 2  # ê±°ë¦¬ ë” ì¤‘ìš”
        features.budget_compatibility *= 1.5  # ì˜ˆì‚° ì í•©ì„± ì¤‘ìš”

# ì¿ í° ì ìš© (user_coupon_wallet)
apply_emergency_coupons(recommendations, user_id)
```

#### 3ë‹¨ê³„: ì„±ëŠ¥ ë¡œê¹…
```python
# performance_logs í…Œì´ë¸”ì— ê¸°ë¡
log_performance({
    'operation_type': 'emergency_recommendation',
    'total_time_ms': 245,
    'nlu_time_ms': 32,
    'rag_time_ms': 78,
    'recommendation_time_ms': 89,
    'bottleneck_component': 'rag_search'
})
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ê°œì¸í™” ì¶”ì²œ ì§„í™” ê³¼ì •

#### Phase 1: ì˜¨ë³´ë”© (1-3íšŒ ëŒ€í™”)
```python
# user_journey_analytics ì¶”ì 
update_journey_stage(user_id, 'onboarding')

# ê¸°ë³¸ ì„ í˜¸ë„ ìˆ˜ì§‘
if interaction_count < 3:
    response = "ì–´ë–¤ ì¢…ë¥˜ì˜ ìŒì‹ì„ ì¢‹ì•„í•˜ì„¸ìš”?"
    strategy = 'data_building_mode'
```

#### Phase 2: í”„ë¡œí•„ êµ¬ì¶• (4-10íšŒ)
```python
# user_profiles ì—…ë°ì´íŠ¸
update_user_profile({
    'preferred_categories': extract_category_preferences(),
    'average_budget': calculate_typical_budget(),
    'personality_type': infer_personality_type()
})

# feature_vectors ìƒì„±
create_initial_feature_vectors(user_id)
```

#### Phase 3: ê³ ê¸‰ ê°œì¸í™” (10íšŒ ì´ìƒ)
```python
# recommendation_features ì •êµí™”
enhanced_features = {
    'time_based_preferences': learn_temporal_patterns(),
    'companion_based_preferences': analyze_group_dynamics(),
    'mood_based_selections': correlate_with_context()
}

# ì˜ˆì¸¡ ëª¨ë¸ í™œì„±í™”
next_order = predict_next_order(user_id)
churn_risk = assess_churn_probability(user_id)
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: A/B í…ŒìŠ¤íŠ¸ ë° ëª¨ë¸ ê°œì„ 

#### ì‹¤í—˜ ì„¤ì •
```python
# Aê·¸ë£¹: ê¸°ì¡´ Wide&Deep ëª¨ë¸
# Bê·¸ë£¹: LoRA íŒŒì¸íŠœë‹ëœ ëª¨ë¸

if user_id in ab_test_group_b:
    model = load_lora_adapted_model()
    recommendations = model.predict(features)
    
    # ì‹¤í—˜ ê²°ê³¼ ì¶”ì 
    track_ab_test_metrics(user_id, 'lora_model', recommendations)
```

#### ëª¨ë¸ ì¬í›ˆë ¨
```python
# model_training_logsì— ìƒˆ ì„¸ì…˜ ì‹œì‘
training_session = start_training_session({
    'model_type': 'lora_adapter',
    'training_data': prepare_training_data(),
    'hyperparameters': {
        'lora_rank': 16,
        'learning_rate': 0.0001,
        'epochs': 5
    }
})

# í›ˆë ¨ ì§„í–‰ ìƒí™© ì¶”ì 
update_training_progress(training_session.id, epoch, loss)
```

---

## 13. êµ¬í˜„ ê°€ì´ë“œ

### êµ¬í˜„ ìš°ì„ ìˆœìœ„

#### Phase 1: í•µì‹¬ ê¸°ëŠ¥ (2ì£¼)
1. **ê¸°ë³¸ í…Œì´ë¸”**: shops, menus, users, foodcard_users, product_orders
2. **ëŒ€í™” ì‹œìŠ¤í…œ**: conversations, conversation_contexts
3. **ê¸°ë³¸ ì¶”ì²œ**: recommendations_log
4. **ì¿ í° ì‹œìŠ¤í…œ**: coupons, user_coupon_wallet

#### Phase 2: ì„±ëŠ¥ ìµœì í™” (1ì£¼)
5. **ìºì‹± ì‹œìŠ¤í…œ**: rag_query_cache, embedding_cache
6. **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: performance_logs
7. **íŠ¹ì§• ì €ì¥**: feature_vectors

#### Phase 3: ML/AI ê³ ë„í™” (2ì£¼)
8. **ì¶”ì²œ ê³ ë„í™”**: recommendation_features
9. **í•™ìŠµ ì‹œìŠ¤í…œ**: nlu_training_data, model_training_logs
10. **ì‚¬ìš©ì ë¶„ì„**: user_profiles, user_journey_analytics

### ì„±ëŠ¥ ìµœì í™” ì „ëµ

#### 1. ì¸ë±ìŠ¤ ì„¤ê³„
```sql
-- ë³µí•© ì¸ë±ìŠ¤ (ìì£¼ í•¨ê»˜ ì¡°íšŒë˜ëŠ” í•„ë“œ)
CREATE INDEX idx_shop_status_category ON shops(current_status, category, is_food_card_shop);
CREATE INDEX idx_user_time_intent ON conversations(user_id, timestamp, extracted_intent);
CREATE INDEX idx_rec_user_score ON recommendation_features(user_id, predicted_score DESC);

-- ë¶€ë¶„ ì¸ë±ìŠ¤ (íŠ¹ì • ì¡°ê±´ë§Œ)
CREATE INDEX idx_active_coupons ON user_coupon_wallet(user_id, status) WHERE status = 'ACTIVE';
CREATE INDEX idx_recent_logs ON performance_logs(timestamp) WHERE timestamp > DATE_SUB(NOW(), INTERVAL 1 DAY);
```

#### 2. íŒŒí‹°ì…”ë‹ ì „ëµ
```sql
-- ì‹œê°„ ê¸°ë°˜ íŒŒí‹°ì…”ë‹ (ëŒ€ìš©ëŸ‰ ë¡œê·¸ í…Œì´ë¸”)
ALTER TABLE conversations PARTITION BY RANGE (YEAR(timestamp)) (
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- í•´ì‹œ íŒŒí‹°ì…”ë‹ (ê· ë“± ë¶„ì‚°)
ALTER TABLE feature_vectors PARTITION BY HASH(entity_id) PARTITIONS 16;
```

#### 3. ë°°ì¹˜ ì²˜ë¦¬ ë° ì§‘ê³„
```python
# 5ë¶„ë§ˆë‹¤ ë°°ì¹˜ ì²˜ë¦¬
async def batch_process_logs():
    # 1. ì„±ëŠ¥ ë¡œê·¸ ì§‘ê³„
    aggregate_performance_metrics()
    
    # 2. íŠ¹ì§• ë²¡í„° ì—…ë°ì´íŠ¸
    update_feature_vectors_batch()
    
    # 3. ìºì‹œ ì •ë¦¬
    cleanup_expired_cache()
    
    # 4. í•™ìŠµ ë°ì´í„° ì¤€ë¹„
    prepare_training_batch()
```

### ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼

#### ì£¼ìš” ëª¨ë‹ˆí„°ë§ ì§€í‘œ
```python
MONITORING_METRICS = {
    'response_time': {
        'threshold': 500,  # ms
        'alert': 'Response time > 500ms'
    },
    'cache_hit_rate': {
        'threshold': 0.7,
        'alert': 'Cache hit rate < 70%'
    },
    'nlu_accuracy': {
        'threshold': 0.85,
        'alert': 'NLU accuracy < 85%'
    },
    'recommendation_ctr': {
        'threshold': 0.25,
        'alert': 'CTR < 25%'
    }
}
```

### ë°ì´í„° ë³´ì¡´ ì •ì±…
```sql
-- í…Œì´ë¸”ë³„ ë³´ì¡´ ê¸°ê°„
DATA_RETENTION_POLICY = {
    -- ì˜êµ¬ ë³´ì¡´
    'users': None,
    'product_orders': None,
    'user_profiles': None,
    
    -- ì¥ê¸° ë³´ì¡´ (1ë…„)
    'conversations': 365,
    'recommendations_log': 365,
    'user_interactions': 365,
    
    -- ì¤‘ê¸° ë³´ì¡´ (3ê°œì›”)
    'performance_logs': 90,
    'nlu_training_data': 90,
    
    -- ë‹¨ê¸° ë³´ì¡´ (1ê°œì›”)
    'rag_query_cache': 30,
    'embedding_cache': 30,
    
    -- ë§¤ìš° ë‹¨ê¸° (7ì¼)
    'conversation_contexts': 7
}
```

---

## ğŸ¯ í•µì‹¬ í¬ì¸íŠ¸ ìš”ì•½

### 1. ë°ì´í„° ì•„í‚¤í…ì²˜
- **3ì¸µ ìºì‹œ êµ¬ì¡°**: ë©”ëª¨ë¦¬ â†’ Redis â†’ Database
- **ì‹¤ì‹œê°„ + ë°°ì¹˜ í•˜ì´ë¸Œë¦¬ë“œ**: ì¦‰ì‹œ ì²˜ë¦¬ì™€ ë°°ì¹˜ ìµœì í™” ë³‘í–‰
- **íŠ¹ì§• ì¤‘ì‹¬ ì„¤ê³„**: ML ëª¨ë¸ì„ ìœ„í•œ íŠ¹ì§• ì‚¬ì „ ê³„ì‚° ë° ì €ì¥

### 2. AI/ML ìµœì í™”
- **ì„ë² ë”© ìºì‹±**: ë°˜ë³µ ê³„ì‚° ë°©ì§€
- **RAG ê²°ê³¼ ìºì‹±**: ìœ ì‚¬ ì¿¼ë¦¬ ë¹ ë¥¸ ì‘ë‹µ
- **íŠ¹ì§• ë²„ì „ ê´€ë¦¬**: ëª¨ë¸ ì—…ë°ì´íŠ¸ ì‹œ í˜¸í™˜ì„± ìœ ì§€

### 3. ê°œì¸í™” ì „ëµ
- **ì ì§„ì  í”„ë¡œí•„ êµ¬ì¶•**: ì˜¨ë³´ë”© â†’ ê¸°ë³¸ â†’ ê³ ê¸‰ ê°œì¸í™”
- **ë‹¤ì°¨ì› ì„ í˜¸ë„**: ì‹œê°„, ìƒí™©, ë™ë°˜ìë³„ ì„ í˜¸ë„
- **ì˜ˆì¸¡ ëª¨ë¸**: ë‹¤ìŒ ì£¼ë¬¸, ì´íƒˆ ìœ„í—˜ ì˜ˆì¸¡

### 4. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- **ë³‘ëª© ì§€ì  ìë™ ê°ì§€**: êµ¬ê°„ë³„ ì‹œê°„ ì¸¡ì •
- **í’ˆì§ˆ ì§€í‘œ ì¶”ì **: NLU ì •í™•ë„, ì¶”ì²œ CTR
- **ìë™ ìµœì í™” ì œì•ˆ**: AI ê¸°ë°˜ ì„±ëŠ¥ ê°œì„  ì œì•ˆ

### 5. ê¸‰ì‹ì¹´ë“œ íŠ¹í™”
- **ì”ì•¡ ê¸°ë°˜ ì¶”ì²œ**: ì‹¤ì‹œê°„ ì”ì•¡ í™•ì¸ ë° ìµœì í™”
- **ê¸´ê¸‰ ì¿ í° ì‹œìŠ¤í…œ**: ì›”ë§ ì”ì•¡ ë¶€ì¡± ì‹œ ìë™ ì§€ì›
- **ì‚¬ìš© íŒ¨í„´ ë¶„ì„**: ì›”ë³„ ì‚¬ìš© íŒ¨í„´ìœ¼ë¡œ ì˜ˆì‚° ê´€ë¦¬ ì¡°ì–¸

ì´ ì¢…í•© ê°€ì´ë“œ v2ëŠ” ë‚˜ë¹„ì–Œ ì±—ë´‡ì˜ ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ìš”êµ¬ì‚¬í•­ì„ í¬í•¨í•˜ë©°, ê°œë°œë¶€í„° ìš´ì˜ê¹Œì§€ ì „ì²´ ë¼ì´í”„ì‚¬ì´í´ì„ ì§€ì›í•©ë‹ˆë‹¤.