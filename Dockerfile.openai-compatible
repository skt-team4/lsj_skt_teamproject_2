# OpenAI 호환 AI 서버 Docker 이미지
FROM python:3.10-slim

# 작업 디렉토리 설정
WORKDIR /app

# 시스템 패키지 설치
RUN apt-get update && apt-get install -y \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Python 패키지 설치
RUN pip install --no-cache-dir \
    torch --index-url https://download.pytorch.org/whl/cpu \
    transformers \
    fastapi \
    uvicorn[standard] \
    pydantic

# 서버 파일 복사
COPY openai_compatible_server.py .

# 환경 변수 설정
ENV PYTHONUNBUFFERED=1
ENV PORT=8000
ENV CUSTOM_API_KEY=sk-workstation-123456789

# 헬스체크
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8000/health || exit 1

# 포트 노출
EXPOSE 8000

# 서버 실행
CMD ["python", "openai_compatible_server.py"]